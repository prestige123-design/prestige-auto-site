<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Prestige Auto | Used Cars Beit Shemesh & Jerusalem</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#b71c1c;
  --dark:#0f172a;
  --muted:#64748b;
  --bg:#f8fafc;
  --card:#ffffff;
  --radius:16px;
  --shadow:0 10px 28px rgba(0,0,0,.08);
}

*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--dark)}
a{text-decoration:none;color:inherit}
button,input,select,textarea{font-family:inherit}

header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid #e5e7eb}
.nav{max-width:1200px;margin:auto;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:14px}
nav a{margin-left:16px;font-weight:600;color:#334155}
.nav-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.small-btn{border:1px solid #e5e7eb;background:#fff;border-radius:10px;padding:10px 12px;font-weight:700;cursor:pointer}
.small-btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}

.hero{
  background:linear-gradient(rgba(0,0,0,.55),rgba(0,0,0,.55)),
  url('https://images.unsplash.com/photo-1605559424843-9e4c228bf1c5?q=80&w=1600') center/cover no-repeat;
  color:#fff;
}
.hero-inner{max-width:1200px;margin:auto;padding:90px 18px}
.hero h1{font-size:clamp(32px,5vw,48px);margin:0 0 12px;font-weight:800}
.hero p{font-size:clamp(16px,3vw,20px);max-width:650px;margin:0 0 22px}
.cta{display:inline-block;background:var(--primary);color:#fff;padding:14px 22px;border-radius:12px;font-weight:800}

section{max-width:1200px;margin:60px auto;padding:0 18px}
h2{font-size:28px;margin:0 0 18px}
.sub{color:var(--muted);margin:-10px 0 18px}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}
.card{background:#fff;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow)}
.carousel{position:relative}
.carousel img{width:100%;height:210px;object-fit:cover;display:none;cursor:pointer}
.carousel img.active{display:block}
.nav-btn{
  position:absolute;top:50%;transform:translateY(-50%);
  width:38px;height:38px;border-radius:50%;border:none;
  background:rgba(0,0,0,.55);color:#fff;font-size:22px;cursor:pointer;
}
.prev{left:10px}.next{right:10px}
.thumbs{display:flex;gap:8px;padding:8px;overflow-x:auto}
.thumbs img{width:60px;height:44px;object-fit:cover;border-radius:8px;opacity:.65;cursor:pointer}
.thumbs img.active{opacity:1;outline:2px solid var(--primary)}
.card-body{padding:16px}
.title{font-weight:800;font-size:17px}
.meta{color:var(--muted);font-size:14px;margin:6px 0}
.price{font-size:20px;font-weight:900;margin-top:6px}
.wa{margin-top:10px;display:block;text-align:center;background:#25D366;color:#fff;padding:12px;border-radius:10px;font-weight:800}

.about{background:#fff;border-radius:var(--radius);padding:28px;box-shadow:var(--shadow)}

.lightbox{
  position:fixed;inset:0;background:rgba(0,0,0,.92);
  display:none;align-items:center;justify-content:center;z-index:999;
  touch-action:none;
}
.lightbox.active{display:flex}
.lightbox img{max-width:94%;max-height:94%}
.close{position:absolute;top:18px;right:20px;font-size:34px;color:#fff;cursor:pointer;user-select:none}

.whatsapp-float{
  position:fixed;right:18px;bottom:18px;z-index:2000;
  width:60px;height:60px;border-radius:50%;
  background:#25D366;color:#fff;display:flex;align-items:center;justify-content:center;
  box-shadow:0 8px 22px rgba(0,0,0,.22);font-size:28px;
}

.modal{
  position:fixed;inset:0;background:rgba(15,23,42,.65);
  display:none;align-items:center;justify-content:center;z-index:3000;
}
.modal.active{display:flex}
.panel{
  width:min(720px,92vw);background:#fff;border-radius:18px;
  box-shadow:0 18px 45px rgba(0,0,0,.25);
  padding:18px;
}
.panel h3{margin:0 0 10px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
.field label{font-weight:700;color:#334155}
.field input,.field textarea,.field select{
  border:1px solid #e5e7eb;border-radius:12px;padding:12px;font-size:14px;outline:none;
}
.field textarea{min-height:90px;resize:vertical}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.hr{height:1px;background:#e5e7eb;margin:14px 0}
.pill{display:inline-flex;gap:8px;align-items:center;padding:8px 10px;border:1px solid #e5e7eb;border-radius:999px;color:#334155;font-weight:700}
.muted{color:var(--muted)}
.danger{background:#fff;border:1px solid #fecaca;color:#991b1b}
.ok{background:#ecfdf5;border:1px solid #bbf7d0;color:#065f46}

.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #eef2f7;padding:10px;text-align:left;font-size:14px}
.table th{color:#334155}

@media (max-width:780px){
  .row,.row3{grid-template-columns:1fr}
  nav a{margin-left:12px}
  .carousel img{height:190px}
}
</style>
</head>

<body>

<header>
  <div class="nav">
    <!-- AI-style inline SVG logo (no files needed) -->
    <div style="display:flex;align-items:center;gap:10px">
      <svg width="190" height="40" viewBox="0 0 190 40" xmlns="http://www.w3.org/2000/svg" aria-label="Prestige Auto">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#b71c1c"/>
            <stop offset="1" stop-color="#7f1d1d"/>
          </linearGradient>
        </defs>
        <rect x="0" y="0" width="190" height="40" rx="12" fill="#0b1220"/>
        <path d="M26 23c2-6 5-10 12-10h20c6 0 10 4 12 10l2 1v6h-6a6 6 0 0 1-12 0H38a6 6 0 0 1-12 0h-6v-6l6-1z" fill="url(#g)"/>
        <circle cx="38" cy="30" r="4" fill="#fff"/>
        <circle cx="66" cy="30" r="4" fill="#fff"/>
        <text x="92" y="25" font-family="Inter, system-ui" font-size="14" fill="#fff" font-weight="800">Prestige</text>
        <text x="92" y="36" font-family="Inter, system-ui" font-size="11" fill="#cbd5e1" font-weight="700">AUTO</text>
      </svg>
      <span class="pill">Beit Shemesh â€¢ Jerusalem</span>
    </div>

    <div class="nav-right">
      <nav>
        <a href="#inventory">Inventory</a>
        <a href="#sell">Buy/Sell</a>
        <a href="#about">About</a>
      </nav>
      <button class="small-btn" id="adminBtn">Admin</button>
      <button class="small-btn primary" id="openLeadBtn">WhatsApp Form</button>
    </div>
  </div>
</header>

<div class="hero">
  <div class="hero-inner">
    <h1>Prestige Auto</h1>
    <p>We buy, sell, and repair all makes and models. Same-day professional service you can count on â€” serving Beit Shemesh, Jerusalem, and surrounding areas.</p>
    <a class="cta" href="#inventory">View Inventory</a>
  </div>
</div>

<section id="inventory">
  <h2>Available Vehicles</h2>
  <div class="sub">Tap a photo to expand. Swipe on mobile.</div>
  <div class="grid" id="cars"></div>
</section>

<section id="sell">
  <h2>Buy / Sell via WhatsApp</h2>
  <div class="about">
    <p class="muted" style="margin-top:0">Fill the form and it will open WhatsApp with a ready-to-send message.</p>
    <div class="row">
      <div class="field">
        <label>First name</label>
        <input id="fn" placeholder="First name" />
      </div>
      <div class="field">
        <label>Last name</label>
        <input id="ln" placeholder="Last name" />
      </div>
    </div>
    <div class="row">
      <div class="field">
        <label>Phone number</label>
        <input id="phone" placeholder="+972..." />
      </div>
      <div class="field">
        <label>Buying or Selling</label>
        <select id="intent">
          <option value="Buying">Buying</option>
          <option value="Selling">Selling</option>
        </select>
      </div>
    </div>
    <div class="row3">
      <div class="field">
        <label>Make</label>
        <input id="make" placeholder="Toyota" />
      </div>
      <div class="field">
        <label>Model</label>
        <input id="model" placeholder="Corolla" />
      </div>
      <div class="field">
        <label>Year</label>
        <input id="year" placeholder="2020" inputmode="numeric" />
      </div>
    </div>
    <div class="actions">
      <button class="small-btn primary" id="sendWhatsApp">Send to WhatsApp</button>
      <span class="muted">Tip: Add your real WhatsApp number in the settings at the top of the script.</span>
    </div>
  </div>
</section>

<section id="about">
  <h2>About Us</h2>
  <div class="about">
    <p><strong>Prestige Auto</strong> proudly serves Beit Shemesh, Jerusalem, and surrounding areas. We buy, sell, and repair all makes and models with honest pricing and professional service.</p>
  </div>
</section>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <div class="close" id="lbClose">Ã—</div>
  <img id="lightboxImg" alt="Expanded vehicle photo" />
</div>

<!-- Floating WhatsApp button -->
<a class="whatsapp-float" id="waFloat" href="#" aria-label="Chat on WhatsApp">ðŸ’¬</a>

<!-- Admin modal -->
<div class="modal" id="adminModal" aria-hidden="true">
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
      <h3 style="margin:0">Admin</h3>
      <button class="small-btn" id="closeAdmin">Close</button>
    </div>

    <div id="adminSignedOut">
      <p class="muted">Login to manage inventory (upload multiple images + details to Firebase Storage/Firestore).</p>
      <div class="row">
        <div class="field">
          <label>Email</label>
          <input id="adminEmail" placeholder="admin@email.com" />
        </div>
        <div class="field">
          <label>Password</label>
          <input id="adminPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </div>
      </div>
      <div class="actions">
        <button class="small-btn primary" id="loginBtn">Login</button>
        <span class="pill">Firebase Auth (Email/Password)</span>
      </div>
      <div class="hr"></div>
      <p class="muted" style="margin:0">
        You must paste your Firebase config into the script (look for <strong>firebaseConfig</strong>).
      </p>
    </div>

    <div id="adminSignedIn" style="display:none">
      <div class="actions" style="justify-content:space-between">
        <span class="pill ok" id="whoami">Logged in</span>
        <button class="small-btn danger" id="logoutBtn">Logout</button>
      </div>

      <div class="hr"></div>

      <h3 style="margin:0 0 10px">Add Vehicle</h3>
      <div class="row3">
        <div class="field">
          <label>Year</label>
          <input id="carYear" placeholder="2020" inputmode="numeric" />
        </div>
        <div class="field">
          <label>Make</label>
          <input id="carMake" placeholder="Toyota" />
        </div>
        <div class="field">
          <label>Model</label>
          <input id="carModel" placeholder="Corolla" />
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label>Price</label>
          <input id="carPrice" placeholder="â‚ª72,000" />
        </div>
        <div class="field">
          <label>Images (multi)</label>
          <input id="carImages" type="file" accept="image/*" multiple />
        </div>
      </div>
      <div class="field">
        <label>Description</label>
        <textarea id="carDesc" placeholder="Condition, mileage, notes..."></textarea>
      </div>
      <div class="actions">
        <button class="small-btn primary" id="saveCarBtn">Upload & Publish</button>
        <span class="muted" id="adminStatus"></span>
      </div>

      <div class="hr"></div>

      <h3 style="margin:0 0 10px">Current Inventory</h3>
      <div style="overflow:auto">
        <table class="table" id="adminTable">
          <thead>
            <tr>
              <th>Vehicle</th>
              <th>Price</th>
              <th>Images</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="adminRows"></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<!-- Firebase (Compat for simplicity in single file) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<script>
/* =========================
   SETTINGS (EDIT THESE)
========================= */
const WHATSAPP_NUMBER_E164 = "972000000000"; // <-- change to your real WhatsApp number (digits only, country code + number)

/* Paste your Firebase config here (Firebase Console -> Project settings -> Your apps -> Web app) */
const firebaseConfig = {
  apiKey: "REPLACE_ME",
  authDomain: "REPLACE_ME",
  projectId: "REPLACE_ME",
  storageBucket: "REPLACE_ME",
  messagingSenderId: "REPLACE_ME",
  appId: "REPLACE_ME"
};

/* =========================
   BASIC UI HELPERS
========================= */
const $ = (id) => document.getElementById(id);
function openModal(el){ el.classList.add("active"); el.setAttribute("aria-hidden","false"); }
function closeModal(el){ el.classList.remove("active"); el.setAttribute("aria-hidden","true"); }

function waLink(message){
  return `https://wa.me/${WHATSAPP_NUMBER_E164}?text=${encodeURIComponent(message)}`;
}

/* Floating WA button */
$("waFloat").href = waLink("Hi Prestige Auto! I would like to ask about your inventory.");

/* WhatsApp lead form */
function buildLeadMessage(){
  const fn = $("fn").value.trim();
  const ln = $("ln").value.trim();
  const phone = $("phone").value.trim();
  const intent = $("intent").value;
  const make = $("make").value.trim();
  const model = $("model").value.trim();
  const year = $("year").value.trim();

  return [
    "Hi Prestige Auto!",
    `Name: ${fn} ${ln}`.trim(),
    phone ? `Phone: ${phone}` : null,
    `I'm: ${intent}`,
    (make || model || year) ? `Vehicle: ${year} ${make} ${model}`.replace(/\s+/g," ").trim() : null
  ].filter(Boolean).join("\n");
}
$("sendWhatsApp").onclick = () => {
  const msg = buildLeadMessage();
  window.open(waLink(msg), "_blank");
};
$("openLeadBtn").onclick = () => document.querySelector("#sell").scrollIntoView({behavior:"smooth"});

/* =========================
   LIGHTBOX + SWIPE
========================= */
let lbIndex = 0;
let lbImages = [];
let touchStartX = null;

function openLightbox(src, images, index){
  lbImages = images || [src];
  lbIndex = index || 0;
  $("lightboxImg").src = lbImages[lbIndex];
  $("lightbox").classList.add("active");
}
function closeLightbox(){
  $("lightbox").classList.remove("active");
}
$("lbClose").onclick = closeLightbox;
$("lightbox").addEventListener("click", (e) => {
  if(e.target.id === "lightbox") closeLightbox();
});
$("lightbox").addEventListener("touchstart", (e) => {
  touchStartX = e.touches[0].clientX;
}, {passive:true});
$("lightbox").addEventListener("touchend", (e) => {
  if(touchStartX === null) return;
  const dx = e.changedTouches[0].clientX - touchStartX;
  touchStartX = null;
  if(Math.abs(dx) < 40) return;
  if(dx < 0) lbIndex = (lbIndex + 1) % lbImages.length;
  else lbIndex = (lbIndex - 1 + lbImages.length) % lbImages.length;
  $("lightboxImg").src = lbImages[lbIndex];
}, {passive:true});

/* =========================
   INVENTORY RENDERING
========================= */
function renderCars(cars){
  const grid = $("cars");
  grid.innerHTML = "";
  cars.forEach((car) => grid.appendChild(renderCarCard(car)));
}
function renderCarCard(car){
  const card = document.createElement("div");
  card.className = "card";
  const images = (car.images && car.images.length) ? car.images : [
    "https://images.unsplash.com/photo-1617814072417-2b0a8b68b1a3?q=80&w=1200"
  ];

  let idx = 0;
  card.innerHTML = `
    <div class="carousel">
      ${images.map((u,n)=>`<img src="${u}" class="${n===0?'active':''}" data-i="${n}">`).join("")}
      ${images.length > 1 ? `<button class="nav-btn prev">â€¹</button><button class="nav-btn next">â€º</button>` : ""}
    </div>
    ${images.length > 1 ? `
    <div class="thumbs">
      ${images.map((u,n)=>`<img src="${u}" class="${n===0?'active':''}" data-i="${n}">`).join("")}
    </div>` : ""}

    <div class="card-body">
      <div class="title">${escapeHtml(car.year)} ${escapeHtml(car.make)} ${escapeHtml(car.model)}</div>
      <div class="meta">${escapeHtml(car.desc || "")}</div>
      <div class="price">${escapeHtml(car.price || "")}</div>
      <a class="wa" target="_blank" href="${waLink(`Hi Prestige Auto! I'm interested in the ${car.year} ${car.make} ${car.model}.`)}">WhatsApp</a>
    </div>
  `;

  const imgs = [...card.querySelectorAll(".carousel img")];
  const thumbs = [...card.querySelectorAll(".thumbs img")];

  function show(i){
    idx=i;
    imgs.forEach((im,n)=>im.classList.toggle("active",n===i));
    thumbs.forEach((t,n)=>t.classList.toggle("active",n===i));
  }

  if(images.length > 1){
    const prev = card.querySelector(".prev");
    const next = card.querySelector(".next");
    prev.onclick = () => show((idx-1+imgs.length)%imgs.length);
    next.onclick = () => show((idx+1)%imgs.length);
    thumbs.forEach(t => t.onclick = () => show(Number(t.dataset.i)));
  }

  imgs.forEach(im => {
    im.onclick = () => openLightbox(im.src, images, Number(im.dataset.i));
  });

  // swipe gestures on carousel (mobile)
  let startX=null;
  const carousel = card.querySelector(".carousel");
  carousel.addEventListener("touchstart",(e)=>{ startX=e.touches[0].clientX; },{passive:true});
  carousel.addEventListener("touchend",(e)=>{
    if(startX===null || images.length<=1) return;
    const dx=e.changedTouches[0].clientX-startX;
    startX=null;
    if(Math.abs(dx)<40) return;
    if(dx<0) show((idx+1)%imgs.length); else show((idx-1+imgs.length)%imgs.length);
  },{passive:true});

  return card;
}
function escapeHtml(s){
  return String(s ?? "").replace(/[&<>"']/g, (c)=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[c]));
}

/* =========================
   FIREBASE: AUTH + INVENTORY
========================= */
let app=null, auth=null, db=null, storage=null;
let unsubCars=null;

function initFirebase(){
  const needs = Object.values(firebaseConfig).some(v => !v || v === "REPLACE_ME");
  if(needs){
    console.warn("Firebase config not set yet. Showing demo inventory only.");
    return false;
  }
  app = firebase.initializeApp(firebaseConfig);
  auth = firebase.auth();
  db = firebase.firestore();
  storage = firebase.storage();
  return true;
}

const demoCars = [
  {year:2020,make:"Toyota",model:"Corolla",price:"â‚ª72,000",desc:"Low mileage, excellent condition",images:[
    "https://images.unsplash.com/photo-1617814072417-2b0a8b68b1a3?q=80&w=1200",
    "https://images.unsplash.com/photo-1549924231-f129b911e442?q=80&w=1200"
  ]},
  {year:2019,make:"Mazda",model:"3",price:"â‚ª65,000",desc:"Reliable and economical",images:[
    "https://images.unsplash.com/photo-1601924579730-4c5e6f65f33d?q=80&w=1200",
    "https://images.unsplash.com/photo-1597007038011-7e44b36e8c3c?q=80&w=1200"
  ]},
  {year:2021,make:"Hyundai",model:"Elantra",price:"â‚ª78,000",desc:"Modern interior, smooth drive",images:[
    "https://images.unsplash.com/photo-1617531653332-bd46c24f2068?q=80&w=1200",
    "https://images.unsplash.com/photo-1609520505218-7421df66b8b4?q=80&w=1200"
  ]}
];

function listenCars(){
  if(!db) return;
  if(unsubCars) unsubCars();

  unsubCars = db.collection("cars").orderBy("createdAt","desc").onSnapshot((snap)=>{
    const cars = snap.docs.map(d => ({ id:d.id, ...d.data() }));
    renderCars(cars);
    renderAdminRows(cars);
  }, (err)=>{
    console.error(err);
    // fallback
    renderCars(demoCars);
  });
}

function renderAdminRows(cars){
  const tbody = $("adminRows");
  if(!tbody) return;
  tbody.innerHTML = "";
  cars.forEach((c)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><strong>${escapeHtml(c.year)} ${escapeHtml(c.make)} ${escapeHtml(c.model)}</strong><div class="muted">${escapeHtml(c.desc||"")}</div></td>
      <td>${escapeHtml(c.price||"")}</td>
      <td>${(c.images?.length||0)}</td>
      <td><button class="small-btn danger" data-del="${c.id}">Delete</button></td>
    `;
    tr.querySelector("[data-del]").onclick = async ()=>{
      if(!confirm("Delete this vehicle?")) return;
      try{
        await db.collection("cars").doc(c.id).delete();
      }catch(e){ alert("Delete failed: " + e.message); }
    };
    tbody.appendChild(tr);
  });
}

/* Admin modal behavior */
$("adminBtn").onclick = () => openModal($("adminModal"));
$("closeAdmin").onclick = () => closeModal($("adminModal"));

function updateAdminUI(user){
  if(user){
    $("adminSignedOut").style.display = "none";
    $("adminSignedIn").style.display = "block";
    $("whoami").textContent = `Logged in: ${user.email}`;
  }else{
    $("adminSignedOut").style.display = "block";
    $("adminSignedIn").style.display = "none";
  }
}

async function login(){
  if(!auth){ alert("Firebase not configured yet. Paste firebaseConfig first."); return; }
  const email = $("adminEmail").value.trim();
  const pass = $("adminPass").value;
  await auth.signInWithEmailAndPassword(email, pass);
}
async function logout(){
  if(!auth) return;
  await auth.signOut();
}

$("loginBtn").onclick = async ()=>{
  try{ await login(); }
  catch(e){ alert("Login failed: " + e.message); }
};
$("logoutBtn").onclick = async ()=>{
  try{ await logout(); }
  catch(e){ alert("Logout failed: " + e.message); }
};

$("saveCarBtn").onclick = async ()=>{
  if(!auth || !db || !storage){ alert("Firebase not configured yet."); return; }
  const user = auth.currentUser;
  if(!user){ alert("Please login first."); return; }

  const year = $("carYear").value.trim();
  const make = $("carMake").value.trim();
  const model = $("carModel").value.trim();
  const price = $("carPrice").value.trim();
  const desc = $("carDesc").value.trim();
  const files = $("carImages").files;

  if(!year || !make || !model || !price){ alert("Year, make, model, and price are required."); return; }
  if(!files || files.length === 0){ alert("Please select at least 1 image."); return; }

  $("adminStatus").textContent = "Uploading imagesâ€¦";

  try{
    const uploadUrls = [];
    for(let i=0;i<files.length;i++){
      const f = files[i];
      const path = `cars/${Date.now()}_${Math.random().toString(16).slice(2)}_${f.name}`;
      const ref = storage.ref().child(path);
      await ref.put(f);
      const url = await ref.getDownloadURL();
      uploadUrls.push(url);
    }

    $("adminStatus").textContent = "Saving listingâ€¦";
    await db.collection("cars").add({
      year, make, model, price, desc,
      images: uploadUrls,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    $("adminStatus").textContent = "Saved âœ…";
    $("carYear").value=""; $("carMake").value=""; $("carModel").value="";
    $("carPrice").value=""; $("carDesc").value=""; $("carImages").value="";
    setTimeout(()=> $("adminStatus").textContent="", 1500);
  }catch(e){
    console.error(e);
    $("adminStatus").textContent = "";
    alert("Upload failed: " + e.message);
  }
};

/* Init */
renderCars(demoCars);
const ok = initFirebase();
if(ok){
  auth.onAuthStateChanged((user)=>{
    updateAdminUI(user);
  });
  listenCars();
}
</script>

</body>
</html>
